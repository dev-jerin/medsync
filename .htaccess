# ----------------------------------------------------------------------
# MedSync Apache Configuration v2.1
# ----------------------------------------------------------------------

# Turn on the rewrite engine
RewriteEngine On

# Set the base path for rewrite rules
RewriteBase /medsync/

# ----------------------------------------------------------------------
# Section 2: Maintenance Mode (with correct 503 status)
# ----------------------------------------------------------------------
# To enable, create an empty ".maintenance" file in your root directory.
RewriteCond %{DOCUMENT_ROOT}/medsync/.maintenance -f

# Allow access to the 503 page itself and its assets
RewriteCond %{REQUEST_URI} !/error/503\.php$
RewriteCond %{REQUEST_URI} !/error/styles\.css$
RewriteCond %{REQUEST_URI} !/images/

# Send a 503 Service Unavailable header, then show the 503 page.
RewriteRule ^.*$ /medsync/error/503.php [R=503,L]

# ----------------------------------------------------------------------
# Section 3: PHP Error Logging & Security
# ----------------------------------------------------------------------
php_flag display_errors off
php_flag log_errors on
php_value error_log log.txt

# Secure the log file from being accessed via browser
<Files "log.txt">
    Require all denied
</Files>

# ----------------------------------------------------------------------
# Section 4: Custom Error Documents
# ----------------------------------------------------------------------
ErrorDocument 404 /medsync/error/404.php
ErrorDocument 403 /medsync/error/403.php
ErrorDocument 500 /medsync/error/500.php
ErrorDocument 503 /medsync/error/503.php

# ----------------------------------------------------------------------
# Section 5: URL Rewriting (Clean URLs)
# ----------------------------------------------------------------------
# Prevent directory listing
Options -Indexes 

# Remove index.php from the URL
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s(.*)/index\.php [NC]
RewriteRule ^ %1/ [R=301,L]

# Remove .php extension from files
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]