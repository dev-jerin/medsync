# ----------------------------------------------------------------------
# MedSync Apache Configuration for Local Development
# ----------------------------------------------------------------------

# Turn on the rewrite engine
RewriteEngine On

# ----------------------------------------------------------------------
# Section 1: Set the base path for rewrite rules
# ----------------------------------------------------------------------
# This is the directory your project is in, relative to localhost.
RewriteBase /medsync/

# ----------------------------------------------------------------------
# Section 2: Maintenance Mode
# ----------------------------------------------------------------------
# To enable maintenance mode, create an empty file named ".maintenance" in your root directory.
# To disable it, simply delete or rename that file.

# Check if the .maintenance file exists
RewriteCond %{DOCUMENT_ROOT}/medsync/.maintenance -f

# Allow access to the maintenance page itself
RewriteCond %{REQUEST_URI} !/maintenance\.php$

# Allow access to CSS/images for the maintenance page
RewriteCond %{REQUEST_URI} !/error/maintenance\.css$
RewriteCond %{REQUEST_URI} !/images/

# Redirect all other requests to the maintenance page
RewriteRule ^.*$ /medsync/maintenance.php [L]

# ----------------------------------------------------------------------
# Section 3: PHP Error Logging
# ----------------------------------------------------------------------
php_flag display_errors off
php_flag log_errors on
php_value error_log log.txt

# ----------------------------------------------------------------------
# Section 4: Secure Log File
# ----------------------------------------------------------------------
<Files "log.txt">
    Require all denied
</Files>

# ----------------------------------------------------------------------
# Section 5: Custom Error Document for 404 Not Found
# ----------------------------------------------------------------------
# This path must be from the web root (e.g., your htdocs folder).
ErrorDocument 404 /medsync/404.php

# ----------------------------------------------------------------------
# Section 6: URL Rewriting (Clean URLs)
# ----------------------------------------------------------------------
Options -Indexes 

# Rule 1: Remove index.php from the URL
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s(.*)/index\.php [NC]
RewriteRule ^ %1/ [R=301,L]

# Rule 2: Remove .php extension from files
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]

